<script>
// 双层背景系统：忠实使用assets/media HTML文件通过iframe
document.addEventListener('DOMContentLoaded', function() {
    // 延迟加载确保页面完全渲染
    setTimeout(function() {
        
        // === 1. 先创建Matrix About Me背景iframe ===
        createMatrixAboutMeBackgroundIframe();
        
        // === 2. 备用MLP背景加载机制，防止Matrix加载失败时MLP永远不加载 ===
        setTimeout(function() {
            if (!document.getElementById('mlp-background-iframe')) {
                console.log('🔄 Fallback: Loading MLP background (Matrix may have failed)');
                createMLPBackgroundIframe();
            }
        }, 3000); // 3秒后如果MLP还未加载，强制加载
        
    }, 1000);
});

// MLP神经网络全站背景 - 使用static目录
function createMLPBackgroundIframe() {
    const mlpIframe = document.createElement('iframe');
    mlpIframe.id = 'mlp-background-iframe';
    mlpIframe.src = '/backgrounds/mlp-bg.html';
    mlpIframe.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -2000;
        pointer-events: none;
        border: none;
        opacity: 0.3;
        background: transparent;
    `;
    
    mlpIframe.onload = function() {
        console.log('✅ MLP background loaded successfully from /backgrounds/mlp-bg.html');
    };
    
    mlpIframe.onerror = function() {
        console.warn('❌ Failed to load MLP background, removing iframe');
        mlpIframe.remove();
    };
    
    document.body.insertBefore(mlpIframe, document.body.firstChild);
}

// Matrix About Me背景 - 使用static目录
function createMatrixAboutMeBackgroundIframe() {
    setTimeout(function() {
        // 寻找About Me section 
        const aboutSection = 
            document.querySelector('[class*="resume-biography"]') || 
            document.querySelector('[class*="biography"]') ||
            document.querySelector('.hero-section') ||
            document.querySelector('section[class*="dark"]') ||
            document.querySelector('section:first-of-type');
        
        console.log('Looking for About Me section:', aboutSection);
        if (!aboutSection) {
            console.warn('Could not find About Me section for Matrix background');
            // About Me section找不到时，立即加载MLP背景
            if (!document.getElementById('mlp-background-iframe')) {
                console.log('🔄 No About Me section, loading MLP background immediately');
                createMLPBackgroundIframe();
            }
            return;
        }
        
        const matrixIframe = document.createElement('iframe');
        matrixIframe.id = 'matrix-aboutme-background-iframe';
        matrixIframe.src = '/backgrounds/matrix-transform-bg.html';
        matrixIframe.style.cssText = `
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
            border: none;
            opacity: 0.8;
            background: transparent;
        `;
        
        matrixIframe.onload = function() {
            console.log('✅ Matrix background loaded successfully from /backgrounds/matrix-transform-bg.html');
            // Matrix加载完成后，延迟加载MLP背景（如果还未加载）
            if (!document.getElementById('mlp-background-iframe')) {
                setTimeout(function() {
                    console.log('🔄 Starting MLP background after Matrix loaded');
                    createMLPBackgroundIframe();
                }, 300);
            }
        };
        
        matrixIframe.onerror = function() {
            console.warn('❌ Failed to load Matrix background, removing iframe');
            matrixIframe.remove();
            // Matrix加载失败时，立即尝试加载MLP背景
            if (!document.getElementById('mlp-background-iframe')) {
                console.log('🔄 Matrix failed, loading MLP background immediately');
                setTimeout(function() {
                    createMLPBackgroundIframe();
                }, 100);
            }
        };
        
        // 创建包装容器来控制层级
        const backgroundWrapper = document.createElement('div');
        backgroundWrapper.id = 'matrix-background-wrapper';
        backgroundWrapper.style.cssText = `
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1500;
            pointer-events: none;
            background: #0d1117;
        `;
        
        backgroundWrapper.appendChild(matrixIframe);
        
        // 确保section有relative定位和层级上下文
        aboutSection.style.position = 'relative';
        aboutSection.style.zIndex = '0';
        aboutSection.insertBefore(backgroundWrapper, aboutSection.firstChild);
        
        // 调试信息
        console.log('Matrix background wrapper created and inserted');
        console.log('About section style:', {
            position: aboutSection.style.position,
            zIndex: aboutSection.style.zIndex,
            height: aboutSection.offsetHeight + 'px',
            width: aboutSection.offsetWidth + 'px'
        });
        
    }, 2000); // 延迟2秒，确保页面结构稳定
}
</script>